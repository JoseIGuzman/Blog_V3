---
title: 'Mapping Harvey Two Years Later: FEMA applications and USGS High Water Marks'
author: Jose Guzman
date: '2019-08-25'
slug: mapping-harvey-two-years-later-fema-applications-and-usgs-high-water-marks
categories:
  - R
  - mapping
tags:
  - Data Visualization
  - R
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/pymjs/pym.v1.js"></script>
<script src="/rmarkdown-libs/widgetframe-binding/widgetframe.js"></script>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Two years have passed since Huricane Harvey hit the Texas coastline and the Greater Houston metropolitan area. Harvey stalled around the Houston area for days, pourring rain, overflowing rivers, and flooding homes. The hurricane caused more than $125 billion in damage. In Harris County alone Hurricane Harvey damaged 204,000 homes and apartment buildings. Many Houstonians still recall how they, their families, or friends lost their homes, their cars, or businesses. Harvey marked a before and after in the History of the city and the personal experiences of its residents. Some people where luckier than others, living in homes that were built just high enough for the water to stay in the streets. My parents home in the City of Katy, west of Houston was hit with minor roof leaks. After the rain subsided, I drove around neighborhoods close to my parents house and saw streets filled with carpets,furniture, gutted walls, torn fences, and stalled cars. The same story played out in neighborhoods throughout Greater Houston.</p>
<p>I wanted to visualize how Hurricane Harvey affected different areas in Houston. For this blog, I used FEMA data of renter and homeowner individual assistance applications, as well as United States Geological Survey (USGS) recorded high-water mark points to create an interactive map of Harris County. The City of Houston, working with consulting groups like January Advisors have mapped out different aspects of Harvey damage, using City data of buildings damaged, monetary loss, debris removals, and 911 and 311 calls. The FEMA data I used added to the story, allowing me to expand the data outside of Houston City limits to get a sense of the damage in Harris County. I also displayed the FEMA data alongside the USGS dataset to show how areas with recorded high-water marks during the huricane water relate to the number of applications in each zip code within the County.</p>
<pre class="r"><code># library for loading data
library(readr)
# libraries for Cleaning Data
library(tidyverse)
library(janitor)
# libraries for map
library(tidycensus)
library(widgetframe)
library(htmltools)
library(leaflet)
library(leaflet.extras)
library(sf)</code></pre>
<pre class="r"><code>#clean up headers 
FEMA_Claims_Owners &lt;- clean_names(FEMA_Claims_Owners, &quot;lower_camel&quot;)
FEMA_Claims_Renters &lt;- clean_names(FEMA_Claims_Renters, &quot;lower_camel&quot;)</code></pre>
<pre class="r"><code>#remove &quot;(County) from County column
FEMA_Claims_Owners$county &lt;- str_sub(FEMA_Claims_Owners$county,1,-10)
FEMA_Claims_Renters$county &lt;- str_sub(FEMA_Claims_Renters$county, 1,-10)</code></pre>
<pre class="r"><code>#create totalDamage column for renters
FEMA_Claims_Renters &lt;- FEMA_Claims_Renters %&gt;%
                       mutate(totalDamage = totalWithModerateDamage 
                                          + totalWithModerateDamage 
                                          + totalWithSubstantialDamage)</code></pre>
<pre class="r"><code>#Add OwnerorRenter columns
FEMA_Claims_Renters$OwnerorRenter &lt;- &quot;Renter&quot;
FEMA_Claims_Owners$OwnerorRenter &lt;- &quot;Owner&quot;</code></pre>
<pre class="r"><code>#select owner and renter columns 
FEMA_Selected_Owners &lt;- FEMA_Claims_Owners %&gt;% 
  select(disaster, state, county, city, zipCode, validRegistrations, totalInspected, totalDamage, approvedForFemaAssistance, OwnerorRenter)
FEMA_Selected_Renters &lt;- FEMA_Claims_Renters %&gt;%
  select(disaster, state, county, city, zipCode, validRegistrations, totalInspected, totalDamage, approvedForFemaAssistance, OwnerorRenter)</code></pre>
<pre class="r"><code># binding tables together
Selected_OwnersandRenters &lt;- bind_rows(FEMA_Selected_Owners, FEMA_Selected_Renters)

Selected_OwnersandRenters &lt;- Selected_OwnersandRenters %&gt;%
  filter(disaster == 4332, county == &quot;Harris&quot;)</code></pre>
<pre class="r"><code>#join FEMA data and group by zip code. 
Selected_OwnersandRenters$zipCode &lt;- as.character(Selected_OwnersandRenters$zipCode)

#Group Zip Codes 
FEMA_grouped &lt;- Selected_OwnersandRenters %&gt;% 
                         group_by(zipCode, city) %&gt;%
                         summarise(sumvalidregistrations = sum(validRegistrations), 
                                   sumapproved = sum(approvedForFemaAssistance)) %&gt;%
                                   mutate(Percentageapproved = round(sumapproved/sumvalidregistrations, 2))

FEMA_zipcodes_grouped &lt;- left_join(FEMA_grouped, zip_codes_us,  by = c(&quot;zipCode&quot; = &quot;GEOID&quot;))</code></pre>
<pre class="r"><code>rm(zip_codes_us)</code></pre>
<pre class="r"><code>#drop NA values
FEMA_zipcodes_grouped &lt;- FEMA_zipcodes_grouped %&gt;%
  drop_na()

#filter by removing data in lower percentiles
FEMA_zipcodes_grouped &lt;- FEMA_zipcodes_grouped %&gt;% filter(sumvalidregistrations &gt; 25)

FEMA_zipcodes_grouped$geometry &lt;- st_transform(FEMA_zipcodes_grouped$geometry, 4326)</code></pre>
<pre class="r"><code>#create label column for zip codes, Pantries, 
FEMA_zipcodes_grouped$label &lt;- paste(&quot;&lt;p&gt; Zip Code:&quot;, FEMA_zipcodes_grouped$zipCode,&quot;&lt;/P&gt;&quot;,
                                     &quot;&lt;p&gt; City:&quot;, FEMA_zipcodes_grouped$city,&quot;&lt;/P&gt;&quot;,
                                     &quot;&lt;p&gt; Total Registrations:&quot;, FEMA_zipcodes_grouped$sumvalidregistrations,&quot;&lt;/P&gt;&quot;,
                                     &quot;&lt;p&gt; Total approved:&quot;, FEMA_zipcodes_grouped$sumapproved, &quot;&lt;/P&gt;&quot;, 
                                     &quot;&lt;p&gt; Percent approved:&quot;, FEMA_zipcodes_grouped$Percentageapproved, &quot;&lt;/P&gt;&quot;
                                     )</code></pre>
<pre class="r"><code># create color scheme 
pal &lt;- colorNumeric(&quot;Reds&quot;, domain = FEMA_zipcodes_grouped$sumvalidregistrations, n = 4)

#create Map
map_Fema &lt;- leaflet() %&gt;%
  addProviderTiles(providers$Esri.WorldGrayCanvas) %&gt;%
  setView(lng=-95.310329, lat=29.7752, zoom = 10) %&gt;%
  addHeatmap(lng = High_Water_Marks$longitude, lat = High_Water_Marks$latitude, 
             group = &quot;High Water Marks&quot;,
             intensity = High_Water_Marks$elev_ft, radius = 10, max = 0.3, blur = 10) %&gt;%
  addPolygons(data = FEMA_zipcodes_grouped$geometry, weight = 0.5, smooth = 1.5, opacity = .3,
              fillColor = pal(FEMA_zipcodes_grouped$sumvalidregistrations),
              fillOpacity = .5,
              popup = lapply(FEMA_zipcodes_grouped$label, HTML)) %&gt;%
  addHeatmap(lng = High_Water_Marks$longitude, lat = High_Water_Marks$latitude, 
             group = &quot;High Water Marks&quot;,
             intensity = High_Water_Marks$elev_ft, radius = 15, max = 0.5) %&gt;%
  addLayersControl(
    overlayGroups =c(&quot;High Water Marks&quot;),
    options = layersControlOptions(collapsed=FALSE)
  ) %&gt;% 
  hideGroup(&quot;High Water Marks&quot;) %&gt;%
  addLegend(&quot;bottomright&quot;, pal = pal, values = FEMA_zipcodes_grouped$sumvalidregistrations,
            title = &quot;FEMA Valid Registrations&quot;,
            opacity = 1
  )</code></pre>
<pre class="r"><code>frameWidget(map_Fema)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"url":"/post/2019-08-12-mapping-harvey-two-years-later-fema-applications-and-usgs-high-water-marks_files/figure-html//widgets/widget_unnamed-chunk-16.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
